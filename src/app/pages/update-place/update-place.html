<main class="page">
  <header class="page__heading">
    <h1 class="page__title">Actualizar alojamiento</h1>
    <p class="page__subtitle">Modifica la información de tu espacio para mantenerlo actualizado.</p>
  </header>

  <form class="form-card" [formGroup]="updatePlaceForm" (ngSubmit)="updatePlace()" novalidate>
    <div class="form-card__grid form-card__grid--two-columns">
      <div class="form-group form-group--full">
        <label for="place-title">Título</label>
        <input id="place-title" type="text" formControlName="title" placeholder="Apartamento moderno en el centro" />
      </div>

      <div class="form-group form-group--full">
        <label for="place-description">Descripción</label>
        <textarea id="place-description" formControlName="description" placeholder="Describe las comodidades, ubicación y servicios destacados"></textarea>
      </div>

      <div class="form-group">
        <label for="place-price">Precio por noche</label>
        <input id="place-price" type="number" formControlName="price" min="0" placeholder="0" />
      </div>

      <div class="form-group">
        <label for="place-type">Tipo de alojamiento</label>
        <select id="place-type" formControlName="accommodationType">
          <option value="" disabled selected>Seleccione un tipo de alojamiento</option>
          @for (item of accommodationTypes; track $index) {
            <option value="{{item}}">{{item}}</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="place-capacity">Capacidad de huéspedes</label>
        <input id="place-capacity" type="number" formControlName="capacity" min="1" placeholder="2" />
      </div>

      <div class="form-group">
        <label for="place-country">País</label>
        <input id="place-country" type="text" formControlName="country" placeholder="Colombia" readonly />
        <small class="form-helper">Solo se permite Colombia</small>
      </div>

      <div class="form-group">
        <label for="place-department">Departamento</label>
        <input id="place-department" type="text" formControlName="department" placeholder="Quindío" />
      </div>

      <div class="form-group">
        <label for="place-city">Ciudad</label>
        <select id="place-city" formControlName="city">
          <option value="" disabled selected>Seleccione una ciudad</option>
          @for (item of cities; track $index) {
            <option value="{{item}}">{{item}}</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="place-neighborhood">Barrio</label>
        <input id="place-neighborhood" type="text" formControlName="neighborhood" placeholder="La Castellana" />
      </div>

      <div class="form-group">
        <label for="place-street">Calle</label>
        <input id="place-street" type="text" formControlName="street" placeholder="Calle 10 # 5-20" />
      </div>

      <div class="form-group">
        <label for="place-postal-code">Código postal</label>
        <input id="place-postal-code" type="text" formControlName="postalCode" placeholder="630004" />
      </div>

      <div class="form-group">
        <label for="place-latitude">Latitud</label>
        <input id="place-latitude" type="number" step="any" formControlName="latitude" placeholder="4.5413" />
      </div>

      <div class="form-group">
        <label for="place-longitude">Longitud</label>
        <input id="place-longitude" type="number" step="any" formControlName="longitude" placeholder="-75.6673" />
      </div>

      <div class="form-group form-group--full">
        <label>Servicios adicionales</label>
        <div class="tag-list amenities-options">
          @for (amenity of amenitiesOptions; track amenity.value) {
            <label>
              <input
                type="checkbox"
                [value]="amenity.value"
                (change)="onAmenityToggle(amenity.value, $event.target.checked)"
                [checked]="updatePlaceForm.get('amenities')?.value?.includes(amenity.value)"
              />
              <span>{{ amenity.label }}</span>
            </label>
          }
        </div>
      </div>

      <div class="form-group form-group--full">
        <label for="place-location">Ubicación</label>
        <div id="map"></div>
      </div>

      <div class="form-group form-group--full">
        <label for="place-images">Imágenes del alojamiento</label>
        <input id="place-images" type="file" multiple accept="image/*" (change)="onFileChange($event)" />
        <small class="form-helper">Selecciona imágenes en formato JPG, PNG o WebP (máximo 5MB cada una). Total máximo: 10 imágenes.</small>

        <!-- Preview de imágenes seleccionadas -->
        <div class="image-previews" *ngIf="allImages.length > 0">
          <div class="preview-grid">
            <div class="image-preview" *ngFor="let img of allImages; let i = index; trackBy: trackByIndex">
              <img [src]="img.src" [alt]="'Preview ' + (i + 1)" class="preview-image" />
              <button type="button" class="remove-image-btn" (click)="removeImage(img)" title="Remover imagen">
                <span class="material-symbols-rounded">close</span>
              </button>
            </div>
          </div>
          <div class="preview-info">
            <small class="text-muted">{{ allImages.length }} imagen(es) seleccionada(s)</small>
          </div>
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="updatePlaceForm.invalid"><span class="material-symbols-rounded me-2">save</span>Actualizar alojamiento</button>
  </form>
</main>